<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Counter001</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
  <h1>Nilai Counter</h1>
  <div id="counter-value">Loading...</div>

  <script>
    // Ganti dengan API Key kamu
    const blynkApiKey = 'hiF1yslkUaMM9_kqS1Xki4A_XJMZRzs5';
    //const blynkDeviceId = 'YOUR_DEVICE_ID'; // Ganti dengan ID perangkatmu jika diperlukan

    // URL API untuk mendapatkan nilai counter
    //const blynkUrl = `https://blynk.cloud/external/api/get?token=${blynkApiKey}&pin=V0`;
    //const blynkUrl = `http://iot.serangkota.go.id:8080/{blynkApiKey}/get/V0`;
    const blynkUrl = `http://iot.serangkota.go.id:8080/hiF1yslkUaMM9_kqS1Xki4A_XJMZRzs5/get/V1`;

    // Fungsi untuk mengambil data dari Blynk
    // function getCounterValue() {
    //   $.get(blynkUrl, function(data) {
    //     // Menampilkan nilai counter di halaman
    //     $('#counter-value').text(data);
    //   }). fail(function() {
    //     // Jika ada error dalam permintaan, tampilkan pesan error
    //     $('#counter-value').text('Error fetching data');
    //   });
    // }



        // Fungsi untuk mengambil data dari API Blynk
    function getCounterValue() {
      // Menggunakan jQuery untuk melakukan permintaan HTTP GET ke API Blynk
      $.get(blynkUrl, function(data) {
        // Cek apakah data bisa diparse sebagai angka
        let value = parseFloat(data);
        
        if (!isNaN(value)) {
          // Format angka menjadi 3 angka di belakang koma
          value = value.toFixed(3);
        } else {
          value = 'Invalid data';
        }

        // Menampilkan nilai yang sudah diformat ke dalam div dengan id counter-value
        $('#counter-value').text(value);
      }).fail(function() {
        // Jika ada error dalam permintaan, tampilkan pesan error
        $('#counter-value').text('Error fetching data');
      });
    }

    // Ambil data counter setiap 500 ms
    setInterval(getCounterValue, 1000);
    getCounterValue(); // Ambil data pertama kali saat halaman dimuat
  </script>
</body>
</html>
